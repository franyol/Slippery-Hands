(()=>{"use strict";var t,e=function(){function t(){this.keys=new Map,this.touchCoords=null,document.addEventListener("keydown",this.keyDownHandler.bind(this)),document.addEventListener("keyup",this.keyUpHandler.bind(this)),document.addEventListener("touchstart",this.touchStartHandler.bind(this)),document.addEventListener("touchmove",this.touchMoveHandler.bind(this)),document.addEventListener("touchend",this.touchEndHandler.bind(this))}return t.prototype.keyDownHandler=function(t){this.keys.set(t.key,"down")},t.prototype.keyUpHandler=function(t){this.keys.set(t.key,"up")},t.prototype.touchStartHandler=function(t){var e=t.touches[0];this.touchCoords={x:e.clientX,y:e.clientY}},t.prototype.touchMoveHandler=function(t){var e=t.touches[0];this.touchCoords={x:e.clientX,y:e.clientY}},t.prototype.touchEndHandler=function(t){this.touchCoords=null},t.prototype.getKeyState=function(t){return this.keys.get(t)||"iddle"},t.prototype.getTouchCoords=function(){return this.touchCoords},t}(),n=function(){function t(){this.objects=[],this.isObjsSorted=!0,this.environments=[]}return t.prototype.on_enter=function(){},t.prototype.on_exit=function(){},t.prototype.clean=function(){this.objects.length=0,this.environments.map((function(t){t.clean()})),this.environments.length=0},t.prototype.update=function(){for(var t=0,e=this.objects;t<e.length;t++)e[t].update();for(var n=0,i=this.environments;n<i.length;n++)i[n].update()},t.prototype.render=function(){this.isObjsSorted||(this.objects.sort((function(t,e){return t.prio-e.prio})),this.isObjsSorted=!0);for(var t=0,e=this.objects;t<e.length;t++)e[t].render()},t.prototype.register=function(t){0===t.uuid&&(t.uuid=this.objects.length),this.objects.push(t),this.isObjsSorted=!1},t.prototype.deregister=function(t){this.objects="number"==typeof t?this.objects.filter((function(e){return e.uuid!==t})):this.objects.filter((function(e){return e!==t}))},t}(),i=function(){function t(){this.states=[]}return t.prototype.pushState=function(t){t.on_enter(),this.states.push(t)},t.prototype.popState=function(){this.states.length>0&&this.states.pop().on_exit()},t.prototype.getCurState=function(){return this.states[this.states.length-1]},t.prototype.update=function(){this.states.length>0&&this.states[this.states.length-1].update()},t.prototype.render=function(){for(var t=0,e=this.states;t<e.length;t++)e[t].render()},t}(),o=function(){function t(){this.dt=0,this.fsm=new i,this.inputHandler=new e,this.canvas=document.getElementById("game-screen")}return t.prototype.update=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.fsm.update()},t.prototype.render=function(){var t=this.canvas.getContext("2d");t.imageSmoothingEnabled=!1,t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="white",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsm.render()},t}(),s=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new o),t.instance},t}(),r=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){for(var t=0;t<this.objects.length;t++)this.objects[t].colliders.length=0;for(t=0;t<this.objects.length;t++)for(var e=t+1;e<this.objects.length;e++)this.collided(this.objects[t],this.objects[e])&&(this.objects[t].colliders.push(this.objects[e]),this.objects[e].colliders.push(this.objects[t]));this.objects.map((function(t){switch(t.type){case"stop":case"standard":t.colliders.map((function(e){"stop"===e.type&&(t.x_1+t.w<=e.x?t.x=e.x-t.w:t.x_1>=e.x+e.w?t.x=e.x+e.w:t.y_1+t.h<=e.y?t.y=e.y-t.h:t.y_1>=e.y+e.h&&(t.y=e.y+e.h))}))}}))},t.prototype.collided=function(t,e){return t.layer===e.layer&&(t.x>=e.x&&t.x<=e.x+e.w||t.x+t.w<=e.x+e.w&&t.x+t.w>=e.x)&&(t.y>=e.y&&t.y<=e.y+e.h||t.y+t.h<=e.y+e.h&&t.y+t.h>=e.y)},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(e){return e!==t}))},t}(),h=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new r),t.instance},t}(),a=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){var t=s.getInstance().canvas;this.objects.map((function(e){e.x+e.w>t.width?e.x=t.width-e.w:e.x<0&&(e.x=0),e.y+e.h>t.height?e.y=t.height-e.h:e.y<0&&(e.y=0)}))},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(e){return e!==t}))},t}(),c=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new a),t.instance},t}(),u=function(){function t(t,e,n,i,o,r){this.uuid=0,this.prio=0,this.game=s.getInstance(),this.hitbox={x:t,y:e,w:n,h:i,x_1:t,y_1:e,colliders:[],visible:!0,type:o?"standard":"stop",layer:0},this.color=r,this.move=o,c.getInstance().register(this.hitbox),h.getInstance().register(this.hitbox)}return t.prototype.update=function(){var t=this.game.inputHandler;if(this.move){this.hitbox.x_1=this.hitbox.x,this.hitbox.y_1=this.hitbox.y;var e=t.getTouchCoords(),n=void 0,i=void 0,o=void 0,s=void 0;n="down"===t.getKeyState("ArrowUp"),e?(console.log(e),n=e.y<this.game.canvas.height/4,i=e.y>3*this.game.canvas.height/4,o=e.x<this.game.canvas.width/4,s=e.x>3*this.game.canvas.width/4):(n="down"===t.getKeyState("ArrowUp"),i="down"===t.getKeyState("ArrowDown"),o="down"===t.getKeyState("ArrowLeft"),s="down"===t.getKeyState("ArrowRight")),this.hitbox.y=n?this.hitbox.y-1:i?this.hitbox.y+1:this.hitbox.y,this.hitbox.x=s?this.hitbox.x+1:o?this.hitbox.x-1:this.hitbox.x}},t.prototype.render=function(){var t=this.game.canvas.getContext("2d");t.fillStyle=this.color,this.hitbox.visible&&t.fillRect(this.hitbox.x,this.hitbox.y,this.hitbox.w,this.hitbox.h)},t}(),p=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){var t=s.getInstance();this.objects.map((function(e){e.yspeed<5?e.yspeed+=t.dt/1e3*15:e.yspeed>7&&(e.yspeed-=t.dt/1e3*15)}))},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(e){return e!==t}))},t}(),d=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new p),t.instance},t}(),f=function(t,e,n,i){return new(n||(n=Promise))((function(o,s){function r(t){try{a(i.next(t))}catch(t){s(t)}}function h(t){try{a(i.throw(t))}catch(t){s(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,h)}a((i=i.apply(t,e||[])).next())}))},y=function(t,e){var n,i,o,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=h(0),r.throw=h(1),r.return=h(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function h(h){return function(a){return function(h){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,h[0]&&(s=0)),s;)try{if(n=1,i&&(o=2&h[0]?i.return:h[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,h[1])).done)return o;switch(i=0,o&&(h=[2&h[0],o.value]),h[0]){case 0:case 1:o=h;break;case 4:return s.label++,{value:h[1],done:!1};case 5:s.label++,i=h[1],h=[0];continue;case 7:h=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==h[0]&&2!==h[0])){s=0;continue}if(3===h[0]&&(!o||h[1]>o[0]&&h[1]<o[3])){s.label=h[1];break}if(6===h[0]&&s.label<o[1]){s.label=o[1],o=h;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(h);break}o[2]&&s.ops.pop(),s.trys.pop();continue}h=e.call(t,s)}catch(t){h=[6,t],i=0}finally{n=o=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,a])}}},l=function(){function t(t,e){this.image=new Image,this.data={frames:new Map},this.current="",this.imgLoaded=!1,this.dataLoaded=!1,this.loadImage(t),this.loadData(e)}return t.prototype.loadImage=function(t){var e=this;this.image.src=t,this.image.onload=function(){e.imgLoaded=!0}},t.prototype.loadData=function(t){return f(this,void 0,void 0,(function(){var e,n=this;return y(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,fetch(t)];case 1:return[4,i.sent().json()];case 2:return e=i.sent(),Object.entries(e.frames).forEach((function(t){var e=t[0],i=t[1];n.data.frames.set(e,i)})),this.dataLoaded=!0,[3,4];case 3:return i.sent(),[3,4];case 4:return[2]}}))}))},t.prototype.setCurrentFrame=function(t){this.data.frames.has(t)&&(this.current=t)},t.prototype.getCurrentFrameData=function(){return this.data.frames.get(this.current)},t.prototype.isReady=function(){return this.imgLoaded&&this.dataLoaded},t.prototype.waitUntilReady=function(){return f(this,void 0,void 0,(function(){return y(this,(function(t){switch(t.label){case 0:return this.isReady()?[3,2]:[4,new Promise((function(t){return setTimeout(t,10)}))];case 1:return t.sent(),[3,0];case 2:return[2]}}))}))},t.prototype.render=function(t,e,n,i){var o,r=s.getInstance().canvas.getContext("2d"),h=null===(o=this.getCurrentFrameData())||void 0===o?void 0:o.frame;h&&this.isReady()&&r.drawImage(this.image,h.x,h.y,h.w,h.h,t,e,n,i)},t}(),g="../../../static/assets/images/main-character/",b=function(){function t(t,e){var n=this;this.uuid=0,this.prio=0,this.xspeed=0,this.yspeed=0,this.game=s.getInstance(),this.sprite=new l(g+"main-character.png",g+"main-character.json"),this.framecount=0,this.sprite.waitUntilReady().then((function(){n.sprite.setCurrentFrame("main-character 0.aseprite")})),this.hitbox={x:t,y:e,w:100,h:100,x_1:t,y_1:e,colliders:[],visible:!0,type:"standard",layer:0},c.getInstance().register(this.hitbox),h.getInstance().register(this.hitbox),d.getInstance().register(this)}return t.prototype.update=function(){var t=this.game.inputHandler;this.hitbox.x_1=this.hitbox.x,this.hitbox.y_1=this.hitbox.y;var e,n,i=t.getTouchCoords();i?(i.y,this.game.canvas.height,i.y,this.game.canvas.height,e=i.x<this.game.canvas.width/4,n=i.x>3*this.game.canvas.width/4):(t.getKeyState("ArrowUp"),t.getKeyState("ArrowDown"),e="down"===t.getKeyState("ArrowLeft"),n="down"===t.getKeyState("ArrowRight")),this.xspeed=0,e?(console.log("left"),this.xspeed-=2):n&&(this.xspeed+=2),this.framecount+=this.game.dt;var o=this.sprite.getCurrentFrameData(),s=this.sprite.current;0===this.xspeed&&this.sprite.isReady()&&o&&this.framecount>o.duration&&(this.framecount=0,this.sprite.setCurrentFrame("main-character 0.aseprite"===s?"main-character 1.aseprite":"main-character 0.aseprite")),this.hitbox.x+=this.xspeed,this.hitbox.y+=this.yspeed},t.prototype.render=function(){this.hitbox&&this.sprite.render(this.hitbox.x,this.hitbox.y,this.hitbox.w,this.hitbox.h)},t}(),x=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return x(e,t),e.prototype.on_enter=function(){var t=window.innerWidth,e=window.innerHeight;this.environments.push(c.getInstance()),this.environments.push(h.getInstance()),this.environments.push(d.getInstance()),this.register(new b(t/2,0)),this.register(new u(t/4,e/2+40,t/2,40,!1,"blue"))},e.prototype.on_exit=function(){this.clean()},e.prototype.update=function(){t.prototype.update.call(this)},e.prototype.render=function(){t.prototype.render.call(this)},e}(n);window.addEventListener("load",(function(){var t=s.getInstance();t.fsm.pushState(new w);var e=performance.now();requestAnimationFrame((function n(i){t.dt=i-e,e=i,t.update(),t.render(),requestAnimationFrame(n)}))}))})();