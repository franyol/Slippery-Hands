(()=>{"use strict";var t,i=function(t,i,e,n){return new(e||(e=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function h(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(r,h)}a((n=n.apply(t,i||[])).next())}))},e=function(t,i){var e,n,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=h(0),r.throw=h(1),r.return=h(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function h(h){return function(a){return function(h){if(e)throw new TypeError("Generator is already executing.");for(;r&&(r=0,h[0]&&(o=0)),o;)try{if(e=1,n&&(s=2&h[0]?n.return:h[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,h[1])).done)return s;switch(n=0,s&&(h=[2&h[0],s.value]),h[0]){case 0:case 1:s=h;break;case 4:return o.label++,{value:h[1],done:!1};case 5:o.label++,n=h[1],h=[0];continue;case 7:h=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==h[0]&&2!==h[0])){o=0;continue}if(3===h[0]&&(!s||h[1]>s[0]&&h[1]<s[3])){o.label=h[1];break}if(6===h[0]&&o.label<s[1]){o.label=s[1],s=h;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(h);break}s[2]&&o.ops.pop(),o.trys.pop();continue}h=i.call(t,o)}catch(t){h=[6,t],n=0}finally{e=s=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,a])}}},n=function(){function t(i,e,n){void 0===n&&(n=!1),this.animations={},this.animTime=0,this.animIdx=0,this.frameTime=0,this.ui=n,this.dir=i,this.name=e,this.image=new Image,this.data={frames:new Map},this.current=0,this.imgLoaded=!1,this.dataLoaded=!1;var s=i+e+".png";s in t.loadedImages?(this.image=t.loadedImages[s].image,t.loadedImages[s].instances++,this.imgLoaded=!0):this.loadImage(s),this.loadData(i+e+".json")}return t.prototype.loadImage=function(i){var e=this;this.image.src=i,this.image.onload=function(){e.imgLoaded=!0,i in t.loadedImages?(e.image=t.loadedImages[i].image,t.loadedImages[i].instances++):t.loadedImages[i]={image:e.image,instances:0}}},t.prototype.loadData=function(t){return i(this,void 0,void 0,(function(){var i,n=this;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch(t)];case 1:return[4,e.sent().json()];case 2:return i=e.sent(),Object.entries(i.frames).forEach((function(t){var i=t[0],e=t[1];n.data.frames.set(i,e)})),this.dataLoaded=!0,[3,4];case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},t.clean=function(){Object.keys(t.loadedImages).forEach((function(i){t.loadedImages[i].instances<=0&&delete t.loadedImages[i]}))},t.prototype.clean=function(){t.loadedImages[this.dir+this.name+".png"].instances--},t.prototype.loadAnimations=function(t){this.animations=t},t.prototype.setCurrentFrame=function(t){var i="".concat(this.name," ").concat(t,".aseprite");this.data.frames.has(i)&&(this.current=t)},t.prototype.getCurrentFrameData=function(){var t="".concat(this.name," ").concat(this.current,".aseprite");return this.data.frames.get(t)},t.prototype.isReady=function(){return this.imgLoaded&&this.dataLoaded},t.prototype.waitUntilReady=function(){return i(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return this.isReady()?[3,2]:[4,new Promise((function(t){return setTimeout(t,10)}))];case 1:return t.sent(),[3,0];case 2:return[2]}}))}))},t.prototype.setCurAnimation=function(t){t in this.animations&&t!==this.curAnimation&&(this.curAnimation=t,this.animIdx=0,this.animTime=0,this.frameTime=0,this.current=this.animations[t][0])},t.prototype.update=function(){if(this.isReady()){var t=y.getInstance();if(this.animTime+=t.dt,this.frameTime+=t.dt,this.curAnimation){var i=this.getCurrentFrameData();if(this.frameTime>i.duration){if(this.frameTime=0,this.animIdx++,this.animIdx>=this.animations[this.curAnimation].length)return this.animIdx=0,this.current=this.animations[this.curAnimation][this.animIdx],!0;this.current=this.animations[this.curAnimation][this.animIdx]}}return!1}},t.prototype.render=function(t,i,e,n,s,o){var r;void 0===s&&(s=!1),void 0===o&&(o=!1);var h=this.ui?y.getInstance().uicanvas.getContext("2d"):y.getInstance().canvas.getContext("2d"),a=null===(r=this.getCurrentFrameData())||void 0===r?void 0:r.frame;a&&this.isReady()&&(h.save(),h.translate(t+e/2,i+n/2),h.scale(s?-1:1,o?-1:1),h.drawImage(this.image,a.x,a.y,a.w,a.h,-e/2,-n/2,e,n),h.restore())},t.loadedImages={},t}(),s=function(){function t(t){this._xspeed=[],this._yspeed=[],this._x=[],this._y=[],this.n=t;for(var i=0;i<this.n;i++)this._xspeed.push(0),this._yspeed.push(0),this._x.push(0),this._y.push(0)}return t.prototype.recordHistory=function(){for(var t=0;t<this.n-1;t++)this._x[t]=this._x[t+1],this._y[t]=this._y[t+1],this._xspeed[t]=this._xspeed[t+1],this._yspeed[t]=this._yspeed[t+1]},t.prototype.update=function(){var t=y.getInstance().dt;this.x+=this.xspeed*t/100,this.y+=this.yspeed*t/100},Object.defineProperty(t.prototype,"x",{get:function(){return this._x[this.n-1]},set:function(t){this._x[this.n-1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"xspeed",{get:function(){return this._xspeed[this.n-1]},set:function(t){this._xspeed[this.n-1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y[this.n-1]},set:function(t){this._y[this.n-1]=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"yspeed",{get:function(){return this._yspeed[this.n-1]},set:function(t){this._yspeed[this.n-1]=t},enumerable:!1,configurable:!0}),t}(),o=function(){function t(t,i,e,n,s,o,r){void 0===o&&(o="standard"),void 0===r&&(r=0),this.color="pink",this.parent=t,this._x=i,this._y=e,this.w=n,this.h=s,this.colliders=[],this.type=o,this.layer=r}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x+this.parent.x},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y+this.parent.y},enumerable:!1,configurable:!0}),t.prototype.getx=function(t){return t>=this.parent.n?this.x:this._x+this.parent._x[this.parent.n-1-t]},t.prototype.gety=function(t){return t>=this.parent.n?this.y:this._y+this.parent._y[this.parent.n-1-t]},t.prototype.render=function(){var t=y.getInstance().canvas.getContext("2d");t.strokeStyle=this.color,t.lineWidth=2,t.strokeRect(this.x,this.y,this.w,this.h)},t}(),r=function(){function t(t,i,e,r,h,a,u,c){void 0===c&&(c=!1),this.uuid=0,this.prio=-1,this.pressed=!1,this.touchIdx=null,this.keyState="iddle",this.placeholder=c,this.game=t,this.position=u,this.sprite=new n("../../../static/assets/images/UI/","Button-"+a,!0),this.physics=new s(1),this.x=i,this.y=e,this.hitbox=new o(this.physics,0,0,r,h,"ui",0)}return t.prototype.update=function(){if(!this.placeholder){var t=this.game.inputHandler,i=t.touches;if(this.physics.x="Bottom-Left"===this.position?0+this.x:"Bottom-Right"===this.position?this.game.uicanvas.width-this.x:this.x,this.physics.y="Bottom-Left"===this.position||"Bottom-Right"===this.position?this.game.uicanvas.height-this.y:this.y,null===this.touchIdx)for(var e=0,n=Object.entries(i);e<n.length;e++){var s,o=n[e],r=o[0];"down"===(s=o[1]).state&&!s.isbusy&&this.touched(s.x,s.y)&&(this.touchIdx=r,this.keyState="down",s.isbusy=!0)}else"up"===(s=t.getTouchState(this.touchIdx)).state?(this.keyState="up",this.touchIdx=null):this.touched(s.x,s.y)||(this.keyState="iddle",this.touchIdx=null,s.isbusy=!1);this.pressed="down"===this.keyState,this.sprite.setCurrentFrame(this.pressed?1:0)}},t.prototype.touched=function(t,i){var e=t>=this.hitbox.x&&t<=this.hitbox.x+this.hitbox.w,n=i>=this.hitbox.y&&i<=this.hitbox.y+this.hitbox.h;return e&&n},t.prototype.render=function(){this.placeholder||this.hitbox&&this.sprite.render(this.hitbox.x,this.hitbox.y,this.hitbox.w,this.hitbox.h,!1)},t}(),h=function(){return h=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var s in i=arguments[e])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},h.apply(this,arguments)},a="../../../static/assets/images/UI/",u=function(){function t(t,i,e,h,u,c,p){void 0===p&&(p=20);var d=this;this.uuid=0,this.prio=-1,this.pressed=!1,this.touchIdx=null,this.initial={x:0,y:0},this.current={x:0,y:0},this.deadzone=p,this.game=t,this.position=c,this.sprite=new n(a,"Joystick",!0),this.sprite.waitUntilReady().then((function(){d.sprite.setCurrentFrame(1)})),this.spritemove=new n(a,"Joystick",!0),this.spritemove.waitUntilReady().then((function(){d.spritemove.setCurrentFrame(0)})),this.physics=new s(1),this.x=i,this.y=e,this.hitbox=new o(this.physics,0,0,h,u,"ui",0),this.joyState={up:new r(t,0,0,0,0,"A","Bottom-Right",!0),down:new r(t,0,0,0,0,"A","Bottom-Right",!0),right:new r(t,0,0,0,0,"A","Bottom-Right",!0),left:new r(t,0,0,0,0,"A","Bottom-Right",!0)}}return t.prototype.update=function(){var t=this.game.inputHandler,i=t.touches,e=Object.entries(i).map((function(t){var i=t[0],e=t[1];return"ID: ".concat(i,", State: ").concat(e.state,", Busy: ").concat(e.isbusy,", X: ").concat(e.x,", Y: ").concat(e.y)})).join("\n");if(this.game.debugText="DEBUG:\n"+e,this.physics.x="Bottom-Left"===this.position?0+this.x:"Bottom-Right"===this.position?this.game.uicanvas.width-this.x:this.x,this.physics.y="Bottom-Left"===this.position||"Bottom-Right"===this.position?this.game.uicanvas.height-this.y:this.y,this.pressed||(this.initial.x=this.physics.x,this.initial.y=this.physics.y,this.current=h({},this.initial)),null===this.touchIdx)for(var n=0,s=Object.entries(i);n<s.length;n++){var o,r=s[n],a=r[0];"down"===(o=r[1]).state&&!o.isbusy&&this.touched(o.x,o.y)&&(this.touchIdx=a,this.pressed=!0,o.isbusy=!0,this.initial.x=o.x-this.hitbox.w/2,this.initial.y=o.y-this.hitbox.h/2,this.current=h({},this.initial))}else"up"===(o=t.getTouchState(this.touchIdx)).state?(this.pressed=!1,o.isbusy=!1,this.touchIdx=null,Object.values(this.joyState).forEach((function(t){t.keyState="up"}))):(this.current.x=o.x-this.hitbox.w/2,this.current.y=o.y-this.hitbox.h/2,this.joyState.up.keyState=this.handleMove(this.joyState.up.keyState,this.current.y>this.initial.y+this.deadzone),this.joyState.down.keyState=this.handleMove(this.joyState.down.keyState,this.current.y<this.initial.y-this.deadzone),this.joyState.right.keyState=this.handleMove(this.joyState.right.keyState,this.current.x>this.initial.x+this.deadzone),this.joyState.left.keyState=this.handleMove(this.joyState.left.keyState,this.current.x<this.initial.x-this.deadzone))},t.prototype.handleMove=function(t,i){return i?"down":"down"===t?"up":t},t.prototype.touched=function(t,i){var e=t>=this.hitbox.x&&t<=this.hitbox.x+this.hitbox.w,n=i>=this.hitbox.y&&i<=this.hitbox.y+this.hitbox.h;return e&&n},t.prototype.render=function(){this.hitbox&&(this.sprite.render(this.initial.x,this.initial.y,this.hitbox.w,this.hitbox.h,!1),this.spritemove.render(this.current.x,this.current.y,this.hitbox.w,this.hitbox.h,!1))},t}(),c=function(){return c=Object.assign||function(t){for(var i,e=1,n=arguments.length;e<n;e++)for(var s in i=arguments[e])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},c.apply(this,arguments)},p=function(){function t(t){this.touches={},this.showVirtual=!1,this.game=t,this.keys=new Map,this.keysReleased=new Map,this.joysticks={left:new u(t,110,170,100,100,"Bottom-Left")},this.bindings={jump:{keybinding:"ArrowUp",virtual:new r(t,170,200,70,70,"A","Bottom-Right")},roll:{keybinding:"ArrowDown",virtual:new r(t,250,120,70,70,"B","Bottom-Right")},left:{keybinding:"ArrowLeft",virtual:this.joysticks.left.joyState.left},right:{keybinding:"ArrowRight",virtual:this.joysticks.left.joyState.right}},document.addEventListener("keydown",this.keyDownHandler.bind(this)),document.addEventListener("keyup",this.keyUpHandler.bind(this)),document.addEventListener("touchstart",this.touchStartHandler.bind(this),{passive:!1}),document.addEventListener("touchmove",this.touchMoveHandler.bind(this),{passive:!1}),document.addEventListener("touchend",this.touchEndHandler.bind(this),{passive:!1}),document.addEventListener("touchcancel",this.touchEndHandler.bind(this),{passive:!1})}return t.prototype.keyDownHandler=function(t){this.keys.set(t.key,"down"),this.showVirtual=!1},t.prototype.keyUpHandler=function(t){this.keys.set(t.key,"up"),this.keysReleased.set(t.key,!0)},t.prototype.touchStartHandler=function(t){var i=this;t.preventDefault(),Array.from(t.changedTouches).forEach((function(t){i.touches[t.identifier]={isbusy:!1,x:t.clientX,y:t.clientY,state:"down"}})),this.showVirtual=!0},t.prototype.touchMoveHandler=function(t){var i=this;t.preventDefault(),Array.from(t.changedTouches).forEach((function(t){i.touches[t.identifier]=c(c({},i.touches[t.identifier]),{x:t.clientX,y:t.clientY})}))},t.prototype.touchEndHandler=function(t){var i=this;t.preventDefault(),Array.from(t.changedTouches).forEach((function(t){i.touches[t.identifier].isbusy?i.touches[t.identifier]=c(c({},i.touches[t.identifier]),{x:t.clientX,y:t.clientY,state:"up"}):delete i.touches[t.identifier]}))},t.prototype.getTouchState=function(t){var i=this.touches[t];return"up"===i.state&&delete this.touches[t],i},t.prototype.getKeyState=function(t){return this.keys.get(t)||"iddle"},t.prototype.getBindingState=function(t){if(t in this.bindings){if(this.showVirtual)return(i=this.bindings[t]).virtual.keyState;var i=this.bindings[t];return this.getKeyState(i.keybinding)}},t.prototype.getKeyOnce=function(t){if(!1===this.keysReleased.get(t))return"iddle";var i=this.getKeyState(t);return"down"===i&&this.keysReleased.set(t,!1),i},t.prototype.setKeyState=function(t,i){this.keys.set(t,i)},t}(),d=function(){function t(){this.objects=[],this.isObjsSorted=!0,this.environments=[]}return t.prototype.on_enter=function(){},t.prototype.on_exit=function(){},t.prototype.clean=function(){this.objects.length=0,this.environments.map((function(t){t.clean()})),this.environments.length=0},t.prototype.update=function(){for(var t=0,i=this.objects;t<i.length;t++)i[t].update();for(var e=0,n=this.environments;e<n.length;e++)n[e].update()},t.prototype.render=function(){this.isObjsSorted||(this.objects.sort((function(t,i){return t.prio-i.prio})),this.isObjsSorted=!0);for(var t=0,i=this.objects;t<i.length;t++)i[t].render()},t.prototype.register=function(t){0===t.uuid&&(t.uuid=this.objects.length),this.objects.push(t),this.isObjsSorted=!1},t.prototype.deregister=function(t){this.objects="number"==typeof t?this.objects.filter((function(i){return i.uuid!==t})):this.objects.filter((function(i){return i!==t}))},t}(),l=function(){function t(){this.states=[]}return t.prototype.pushState=function(t){t.on_enter(),this.states.push(t)},t.prototype.popState=function(){this.states.length>0&&this.states.pop().on_exit()},t.prototype.getCurState=function(){return this.states[this.states.length-1]},t.prototype.update=function(){this.states.length>0&&this.states[this.states.length-1].update()},t.prototype.render=function(){for(var t=0,i=this.states;t<i.length;t++)i[t].render()},t}(),f=function(){function t(){this.dt=0,this.fsm=new l,this.width=4e3,this.height=4e3,this.camx=0,this.camy=0,this._camsize=50,this.camw=16*this._camsize,this.camh=9*this._camsize,this.debugText="",this.canvas=document.getElementById("game-screen"),this.uicanvas=document.getElementById("ui-layer"),this.inputHandler=new p(this)}return Object.defineProperty(t.prototype,"camsize",{set:function(t){this._camsize=t,this.camw=16*t,this.camh=9*t},enumerable:!1,configurable:!0}),t.prototype.update=function(){this.canvas.width=this.width,this.canvas.height=this.height,this.uicanvas.width=window.innerWidth,this.uicanvas.height=window.innerHeight,this.fsm.update(),this.inputHandler.showVirtual&&(Object.values(this.inputHandler.bindings).forEach((function(t){t.virtual.update()})),Object.values(this.inputHandler.joysticks).forEach((function(t){t.update()})))},t.prototype.render=function(){var t=this.canvas.getContext("2d"),i=this.uicanvas.getContext("2d");t.imageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,i.clearRect(0,0,this.uicanvas.width,this.uicanvas.height),t.clearRect(0,0,this.canvas.width,this.canvas.height),t.save(),t.setTransform(this.canvas.width/this.camw,0,0,this.canvas.height/this.camh,-this.camx*(this.canvas.width/this.camw),-this.camy*(this.canvas.height/this.camh)),t.fillStyle="yellow",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsm.render(),t.restore(),this.scale(this.canvas,window.innerWidth,window.innerHeight,this.camw,this.camh),""!==this.debugText&&(i.font="16px Arial",i.fillStyle="red",this.debugText.split("\n").forEach((function(t,e){i.fillText(t,10,30+20*e)}))),this.inputHandler.showVirtual&&(Object.values(this.inputHandler.bindings).forEach((function(t){t.virtual.render()})),Object.values(this.inputHandler.joysticks).forEach((function(t){t.render()})))},t.prototype.scale=function(t,i,e,n,s){var o=i/n,r=e/s,h=Math.min(o,r),a=n*h,u=s*h;t.style.width="".concat(a,"px"),t.style.height="".concat(u,"px"),t.style.position="absolute",t.style.left="".concat((i-a)/2,"px"),t.style.top="".concat((e-u)/2,"px")},t}(),y=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new f),t.instance},t}(),g=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){for(var t=0;t<this.objects.length;t++)this.objects[t].colliders=[];for(t=0;t<this.objects.length;t++)for(var i=t+1;i<this.objects.length;i++)this.collided(this.objects[t],this.objects[i])&&(this.objects[t].colliders.push(this.objects[i]),this.objects[i].colliders.push(this.objects[t]));this.objects.map((function(t){switch(t.type){case"stop":case"standard":t.colliders.map((function(i){if("stop"===i.type){var e=t.getx(1),n=t.gety(1);e+t.w<=i.x?(t.parent.x=i.x-t.w-t._x,t.parent.xspeed=0):e>=i.x+i.w?(t.parent.x=i.x+i.w-t._x,t.parent.xspeed=0):n+t.h<=i.y?(t.parent.y=i.y-t.h-t._y,t.parent.yspeed=0):n>=i.y+i.h?(t.parent.y=i.y+i.h-t._y,t.parent.yspeed=0):(console.log("x_1: ".concat(e," x_2: ").concat(t.w," y_1: ").concat(n)),console.log(i))}}))}}))},t.prototype.collided=function(t,i){if(t.layer!==i.layer)return!1;var e=t.x<i.x+i.w&&t.x+t.w>i.x,n=t.y<i.y+i.h&&t.y+t.h>i.y;return e&&n},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(i){return i!==t}))},t}(),m=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new g),t.instance},t}(),b=function(){function t(t,i,e,n,r,h){this.uuid=0,this.prio=0,this.game=y.getInstance(),this.physics=new s(r?2:1),this.physics.x=t,this.physics.y=i,this.hitbox=new o(this.physics,0,0,e,n,r?"standard":"stop",0),this.hitbox.color=h,this.move=r,m.getInstance().register(this.hitbox)}return t.prototype.update=function(){var t,i,e,n,s=this.game.inputHandler;this.move&&(this.physics.recordHistory(),t="down"===s.getKeyState("ArrowUp"),i="down"===s.getKeyState("ArrowDown"),e="down"===s.getKeyState("ArrowLeft"),n="down"===s.getKeyState("ArrowRight"),this.physics.yspeed=t?-25:i?25:0,this.physics.xspeed=n?25:e?-25:0,this.physics.update())},t.prototype.render=function(){this.hitbox.render()},t}(),x=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects=[]},t.prototype.update=function(){var t=y.getInstance(),i=this.objects[this.objects.length-1];t.camx=i.x+i.w/2-t.camw/2,t.camy=i.y+i.h/2-t.camh/2},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(i){return i!==t}))},t}(),w=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new x),t.instance},t}(),v=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){var t=y.getInstance().dt;this.objects.map((function(i){i.parent.yspeed<80?i.parent.yspeed+=100*t/100:i.parent.yspeed>=100&&(i.parent.yspeed-=100*t/100)}))},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(i){return i!==t}))},t}(),j=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new v),t.instance},t}(),I=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){var t=y.getInstance().canvas,i=!0;this.objects.map((function(e){e.x+e.w>t.width?e.parent.x=t.width-e.w-e._x:e.x<0&&(e.parent.x=-e._x),e.y+e.h>t.height?e.parent.y=t.height-e.h-e._y:e.y<0?e.parent.y=-e._y:i=!1,i&&(e.parent.x=0,e.parent.y=1500)}))},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(i){return i!==t}))},t}(),_=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new I),t.instance},t}(),k=function(){function t(t,i){void 0===i&&(i=0),this.enabled=!1,this.game=y.getInstance(),this.time=t,this.current=i}return t.prototype.update=function(){this.enabled&&(this.current+=this.game.dt,this.current>=this.time&&(this.enabled=!1,this.current=0))},t.prototype.request=function(t,i){return!0===i&&(t||this.enabled)?(this.enabled=!1,this.current=0,!0):(t&&(this.enabled=!0,this.current=0),!1)},t.prototype.retain=function(t){return t&&(this.enabled=!0,this.current=0),t||this.enabled},t}(),S=function(){function t(t,i,e){void 0===e&&(e=0),this.callback=function(){},this.enabled=!0,this.game=y.getInstance(),this.time=i,this.current=e,this.callback=t}return t.prototype.update=function(){this.enabled||(this.current+=this.game.dt,this.current>=this.time&&(this.enabled=!0,this.current=0))},t.prototype.request=function(){this.enabled&&(this.callback(),this.enabled=!1)},t}(),A=function(){function t(){this.callback=function(){},this.enabled=!0}return t.prototype.request=function(t){return t?!(!this.enabled||!t||(this.enabled=!1,0)):(this.enabled=!0,!1)},t}(),O=function(){function t(t,i){var e=this;this.uuid=0,this.prio=0,this.headingLeft=!1,this.jumping=!1,this.falling=!1,this.headbumping=!1,this.rolling=!1,this.running=!1,this.cantmove=!1,this.onfloor=!1,this.jumpcount=0,this.runningspeed=40,this.rollspeed=60,this.jumpingForce=210,this.iddleTime=5e3,this.game=y.getInstance(),this.sprite=new n("../../../static/assets/images/main-character/","main-character"),this.physics=new s(2),this.physics.x=t,this.physics.y=i,this.printbox=new o(this.physics,0,0,64,64,"standard",0),this.hitbox=new o(this.physics,7,0,50,64,"standard",0),this.sprite.loadAnimations({stand:[0,1],toiddle:[2],fromiddle:[2],iddle:[3,4,3,4,3,4,3],tostand:[5],tostilljump:[16],stilljump:[17],torunjump:[31],runjump:[13],falling:[18],bumpfalling:[19],bumppain:[20,21,22,21,22,23,24,23,24,22,20],runfalling:[13],toprepare:[5],prepare:[6,7],torun:[8],roll:[25,26,27,28,29,30],run:[9,10,11,12,13,14,15,12]}),this.sprite.setCurAnimation("stand"),this.cooldowns={rolling:new S((function(){e.rolling=!0,e.sprite.setCurAnimation("roll"),e.hitbox._y=32,e.hitbox.h=32,e.headbumping=!1}),1200)},this.buffers={jump:new k(100),coyotetime:new k(50)},this.pressOnce={jump:new A},_.getInstance().register(this.hitbox),m.getInstance().register(this.hitbox),j.getInstance().register(this.hitbox),w.getInstance().register(this.printbox)}return t.prototype.update=function(){var t,i,e,n,s=this,o=this.game.inputHandler;this.physics.recordHistory(),Object.values(this.cooldowns).forEach((function(t){t.update()})),Object.values(this.buffers).forEach((function(t){t.update()})),t=this.pressOnce.jump.request("down"===o.getBindingState("jump")),i="down"===o.getBindingState("roll"),e="down"===o.getBindingState("left"),n="down"===o.getBindingState("right"),this.physics.xspeed=0,this.running=!1,this.rolling&&!this.cantmove?this.physics.xspeed=this.headingLeft?-this.rollspeed:this.rollspeed:e&&!this.cantmove?(this.physics.xspeed-=this.runningspeed,this.headingLeft=!0,this.running=!0):n&&!this.cantmove&&(this.physics.xspeed+=this.runningspeed,this.headingLeft=!1,this.running=!0),!i||!this.running||this.cantmove||this.headbumping||this.jumping&&!this.falling||this.cooldowns.rolling.request(),this.onfloor=!1,this.hitbox.colliders.map((function(t){t.y>=s.physics.y+s.hitbox.h?s.onfloor=!0:t.y+t.h<=s.hitbox.y&&"stop"===t.type&&!s.rolling&&(s.headbumping=!0)})),this.buffers.jump.request(t,!this.cantmove&&!this.headbumping&&this.jumpcount<1&&this.buffers.coyotetime.retain(this.onfloor))?(this.physics.yspeed=-this.jumpingForce,this.jumpcount++,this.jumping=!0,this.rolling=!1,this.hitbox._y=0,this.hitbox.h=64):this.onfloor&&(this.jumping=!1,this.jumpcount=0),this.headbumping&&(this.cantmove=!0,this.sprite.setCurAnimation("bumppain"),this.hitbox._y=32,this.hitbox.h=32),this.falling=this.physics.yspeed>0&&!this.onfloor,this.handleAnimations(),this.physics.update()},t.prototype.handleAnimations=function(){if(this.running||this.jumping||this.rolling||this.falling?!this.running||this.jumping||this.rolling||this.falling||["run","torun"].includes(this.sprite.curAnimation)?this.jumping&&!this.falling?this.rolling||(this.running?["runjump","torunjump"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("torunjump"):["stilljump","tostilljump"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("tostilljump")):this.falling&&!this.rolling&&(this.headbumping?["bumpfalling"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("bumpfalling"):this.running?["runfalling"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("runfalling"):["falling"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("falling")):this.sprite.setCurAnimation("torun"):this.sprite.animTime>this.iddleTime?this.sprite.setCurAnimation("prepare"===this.sprite.curAnimation?"tostand":"toiddle"):["prepare","toprepare","stand","tostand","toiddle","iddle","fromiddle","bumppain","roll"].includes(this.sprite.curAnimation)||this.sprite.setCurAnimation("prepare"),this.sprite.update())switch(this.sprite.curAnimation){case"roll":this.sprite.setCurAnimation("prepare"),this.rolling=!1,this.hitbox._y=0,this.hitbox.h=64;break;case"toprepare":this.sprite.setCurAnimation("prepare");break;case"tostand":case"fromiddle":this.sprite.setCurAnimation("stand");break;case"iddle":this.sprite.setCurAnimation("fromiddle");break;case"torun":this.sprite.setCurAnimation("run");break;case"toiddle":this.sprite.setCurAnimation("iddle");break;case"tostilljump":this.sprite.setCurAnimation("stilljump");break;case"tosrunjump":this.sprite.setCurAnimation("runjump");break;case"bumppain":this.headbumping=!1,this.cantmove=!1,this.hitbox._y=0,this.hitbox.h=64,this.sprite.setCurAnimation("stand")}},t.prototype.render=function(){this.printbox&&this.sprite.render(this.printbox.x,this.printbox.y,this.printbox.w,this.printbox.h,this.headingLeft),this.hitbox.render()},t}(),C=(t=function(i,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])},t(i,e)},function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),E=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return C(i,t),i.prototype.on_enter=function(){var t=y.getInstance();t.width,t.height,this.environments.push(_.getInstance()),this.environments.push(m.getInstance()),this.environments.push(j.getInstance()),this.environments.push(w.getInstance()),this.register(new O(0,1500)),this.register(new b(0,1800,800,100,!1,"blue")),this.register(new b(200,1560,80,200,!1,"blue")),this.register(new b(400,1600,200,100,!1,"blue")),this.register(new b(700,1600,160,100,!1,"blue")),this.register(new b(1e3,1500,200,100,!1,"blue")),this.register(new b(1300,1400,150,40,!1,"blue")),this.register(new b(1500,1300,150,40,!1,"blue")),this.register(new b(1700,1200,150,40,!1,"blue")),this.register(new b(1800,1100,150,40,!1,"blue")),this.register(new b(2e3,1e3,100,40,!1,"blue")),this.register(new b(2300,1e3,100,40,!1,"blue")),this.register(new b(2600,1400,300,100,!1,"blue")),this.register(new b(3e3,1300,80,200,!1,"blue")),this.register(new b(3200,1800,500,100,!1,"blue"))},i.prototype.on_exit=function(){this.clean()},i.prototype.update=function(){t.prototype.update.call(this)},i.prototype.render=function(){t.prototype.render.call(this)},i}(d);window.addEventListener("load",(function(){var t=y.getInstance();t.fsm.pushState(new E);var i=performance.now();requestAnimationFrame((function e(n){t.dt=n-i,i=n,t.update(),t.render(),requestAnimationFrame(e)}))}))})();