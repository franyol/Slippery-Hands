(()=>{"use strict";var t,e=function(){function t(){this.keys=new Map,document.addEventListener("keydown",this.keyDownHandler.bind(this)),document.addEventListener("keyup",this.keyUpHandler.bind(this))}return t.prototype.keyDownHandler=function(t){this.keys.set(t.key,"down")},t.prototype.keyUpHandler=function(t){this.keys.set(t.key,"up")},t.prototype.getKeyState=function(t){return this.keys.get(t)||"iddle"},t}(),n=function(){function t(){this.objects=[],this.isObjsSorted=!0,this.environments=[]}return t.prototype.on_enter=function(){},t.prototype.on_exit=function(){},t.prototype.clean=function(){this.objects.length=0,this.environments.map((function(t){t.clean()})),this.environments.length=0},t.prototype.update=function(){for(var t=0,e=this.objects;t<e.length;t++)e[t].update();for(var n=0,i=this.environments;n<i.length;n++)i[n].update()},t.prototype.render=function(){this.isObjsSorted||(this.objects.sort((function(t,e){return t.prio-e.prio})),this.isObjsSorted=!0);for(var t=0,e=this.objects;t<e.length;t++)e[t].render()},t.prototype.register=function(t){0===t.uuid&&(t.uuid=this.objects.length),this.objects.push(t),this.isObjsSorted=!1},t.prototype.deregister=function(t){this.objects="number"==typeof t?this.objects.filter((function(e){return e.uuid!==t})):this.objects.filter((function(e){return e!==t}))},t}(),i=function(){function t(){this.states=[]}return t.prototype.pushState=function(t){t.on_enter(),this.states.push(t)},t.prototype.popState=function(){this.states.length>0&&this.states.pop().on_exit()},t.prototype.getCurState=function(){return this.states[this.states.length-1]},t.prototype.update=function(){this.states.length>0&&this.states[this.states.length-1].update()},t.prototype.render=function(){for(var t=0,e=this.states;t<e.length;t++)e[t].render()},t}(),o=function(){function t(){this.dt=0,this.fsm=new i,this.inputHandler=new e,this.canvas=document.getElementById("game-screen")}return t.prototype.update=function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.fsm.update()},t.prototype.render=function(){var t=this.canvas.getContext("2d");t.clearRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="black",t.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsm.render()},t}(),s=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new o),t.instance},t}(),r=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){for(var t=0;t<this.objects.length;t++)this.objects[t].colliders.length=0;for(t=0;t<this.objects.length;t++)for(var e=t+1;e<this.objects.length;e++)this.collided(this.objects[t],this.objects[e])&&(this.objects[t].colliders.push(this.objects[e]),this.objects[e].colliders.push(this.objects[t]));this.objects.map((function(t){switch(t.type){case"stop":case"standard":t.colliders.map((function(e){"stop"===e.type&&(t.x_1+t.w<=e.x?t.x=e.x-t.w:t.x_1>=e.x+e.w?t.x=e.x+e.w:t.y_1+t.h<=e.y?t.y=e.y-t.h:t.y_1>=e.y+e.h&&(t.y=e.y+e.h))}))}}))},t.prototype.collided=function(t,e){return t.layer===e.layer&&(t.x>=e.x&&t.x<=e.x+e.w||t.x+t.w<=e.x+e.w&&t.x+t.w>=e.x)&&(t.y>=e.y&&t.y<=e.y+e.h||t.y+t.h<=e.y+e.h&&t.y+t.h>=e.y)},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(e){return e!==t}))},t}(),h=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new r),t.instance},t}(),c=function(){function t(){this.objects=[]}return t.prototype.clean=function(){this.objects.length=0},t.prototype.update=function(){var t=s.getInstance().canvas;this.objects.map((function(e){e.x+e.w>t.width?e.x=t.width-e.w:e.x<0&&(e.x=0),e.y+e.h>t.height?e.y=t.height-e.h:e.y<0&&(e.y=0)}))},t.prototype.register=function(t){this.objects.push(t)},t.prototype.deregister=function(t){this.objects=this.objects.filter((function(e){return e!==t}))},t}(),u=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new c),t.instance},t}(),a=function(){function t(t,e,n,i,o,r){this.uuid=0,this.prio=0,this.game=s.getInstance(),this.hitbox={x:t,y:e,w:n,h:i,x_1:t,y_1:e,colliders:[],visible:!0,type:o?"standard":"stop",layer:0},this.color=r,this.move=o,u.getInstance().register(this.hitbox),h.getInstance().register(this.hitbox)}return t.prototype.update=function(){var t=this.game.inputHandler;this.move&&(this.hitbox.x_1=this.hitbox.x,this.hitbox.y_1=this.hitbox.y,this.hitbox.y="down"===t.getKeyState("ArrowUp")?this.hitbox.y-1:"down"===t.getKeyState("ArrowDown")?this.hitbox.y+1:this.hitbox.y,this.hitbox.x="down"===t.getKeyState("ArrowRight")?this.hitbox.x+1:"down"===t.getKeyState("ArrowLeft")?this.hitbox.x-1:this.hitbox.x)},t.prototype.render=function(){var t=this.game.canvas.getContext("2d");t.fillStyle=this.color,this.hitbox.visible&&t.fillRect(this.hitbox.x,this.hitbox.y,this.hitbox.w,this.hitbox.h)},t}(),p=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.on_enter=function(){var t=window.innerWidth,e=window.innerHeight;this.environments.push(u.getInstance()),this.environments.push(h.getInstance()),this.register(new a(t/2,e/2,50,40,!0,"red")),this.register(new a(t/4,e/2+40,t/2,40,!1,"blue"))},e.prototype.on_exit=function(){this.clean()},e.prototype.update=function(){t.prototype.update.call(this)},e.prototype.render=function(){t.prototype.render.call(this)},e}(n);window.addEventListener("load",(function(){var t=s.getInstance();t.fsm.pushState(new f);var e=performance.now();requestAnimationFrame((function n(i){t.dt=i-e,e=i,t.update(),t.render(),requestAnimationFrame(n)}))}))})();